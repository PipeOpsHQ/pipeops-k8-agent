# PipeOps Agent Configuration
# This file contains the configuration for the PipeOps agent

# Agent configuration
agent:
  # Unique identifier for this agent (auto-generated if not specified)
  id: ""
  
  # Human-readable name for this agent
  name: "pipeops-agent"
  
  # Name of the cluster this agent manages
  cluster_name: "production-cluster"
  
  # How often to report status to the control plane
  poll_interval: "30s"
  
  # Labels to apply to this agent
  labels:
    environment: "production"
    region: "us-east-1"
    managed-by: "pipeops"

# PipeOps control plane configuration
pipeops:
  # URL of the PipeOps API (HTTP/HTTPS endpoint)
  api_url: "https://api.pipeops.io"
  
  # Authentication token for API access
  token: "your-pipeops-api-token-here"
  
  # Connection timeout
  timeout: "30s"
  
  # Reconnection settings
  reconnect:
    enabled: true
    max_attempts: 10      # 0 for unlimited
    interval: "5s"        # Initial reconnection interval
    backoff: "5s"         # Backoff increment per failed attempt
  
  # TLS configuration
  tls:
    enabled: true
    insecure_skip_verify: false
    cert_file: ""         # Path to client certificate
    key_file: ""          # Path to client private key
    ca_file: ""           # Path to CA certificate

# Tunnel configuration (Portainer-style direct port forwarding)
# Enables on-demand reverse tunneling for direct access to cluster ports
tunnel:
  # Enable/disable tunnel functionality
  enabled: true
  
  # How often to poll control plane for tunnel status (e.g., "5s", "10s")
  poll_interval: "5s"
  
  # Inactivity timeout - tunnel closes after this period of no API requests (e.g., "5m", "10m")
  inactivity_timeout: "5m"
  
  # List of ports to forward through tunnel (Portainer-style)
  # Control plane will dynamically assign remote ports
  forwards:
    - name: "kubernetes-api"
      local_addr: "localhost:6443"    # Direct K8s API access
      remote_port: 0                   # 0 = dynamically assigned
      
    - name: "kubelet-metrics"
      local_addr: "localhost:10250"   # Kubelet metrics
      remote_port: 0
      
    - name: "agent-http"
      local_addr: "localhost:8080"    # Agent HTTP server (health checks)
      remote_port: 0

# Kubernetes configuration
kubernetes:
  # Path to kubeconfig file (leave empty for in-cluster config)
  kubeconfig: ""
  
  # Whether to use in-cluster configuration
  in_cluster: true
  
  # Default namespace for agent operations
  namespace: "pipeops-system"

# Logging configuration
logging:
  # Log level (debug, info, warn, error)
  level: "info"
  
  # Log format (json, text)
  format: "json"
  
  # Log output (stdout, stderr, file path)
  output: "stdout"
