# PipeOps Agent Configuration
# This file contains the configuration for the PipeOps agent

# Agent configuration
agent:
  # Unique identifier for this agent (auto-generated if not specified)
  id: ""
  
  # Human-readable name for this agent
  name: "pipeops-agent"
  
  # Name of the cluster this agent manages
  cluster_name: "production-cluster"
  
  # How often to report status to the control plane
  poll_interval: "30s"
  
  # Labels to apply to this agent
  labels:
    environment: "production"
    region: "us-east-1"
    managed-by: "pipeops"

# PipeOps control plane configuration
pipeops:
  # URL of the PipeOps API (HTTP/HTTPS endpoint)
  api_url: "https://api.pipeops.io"
  
  # Authentication token for API access
  token: "your-pipeops-api-token-here"
  
  # Connection timeout
  timeout: "30s"
  
  # Reconnection settings
  reconnect:
    enabled: true
    max_attempts: 10      # 0 for unlimited
    interval: "5s"        # Initial reconnection interval
    backoff: "5s"         # Backoff increment per failed attempt
  
  # TLS configuration
  tls:
    enabled: true
    insecure_skip_verify: false
    cert_file: ""         # Path to client certificate
    key_file: ""          # Path to client private key
    ca_file: ""           # Path to CA certificate

# FRP (Fast Reverse Proxy) configuration
frp:
  enabled: true
  binary_path: "/usr/local/bin/frpc"  # Path to FRP client binary
  
  # FRP server configuration
  server:
    host: "frp.pipeops.io"
    port: 7000
    url: "https://frp.pipeops.io:7000"
    token: "your-frp-server-token-here"
    timeout: "30s"
    tls:
      enabled: true
      insecure_skip_verify: false
  
  # FRP client configuration
  client:
    name: ""              # Auto-generated if empty
    user: "pipeops-agent"
    server_addr: "frp.pipeops.io"
    server_port: 7000
    token: "your-frp-client-token-here"
    log_level: "info"
    log_file: ""          # Empty for stdout
    admin_addr: "127.0.0.1"
    admin_port: 7400
    admin_user: "admin"
    admin_pwd: ""
    pool_count: 5
    tcp_mux: true
    protocol: "tcp"
    tls_enable: true
    heartbeat_interval: "30s"
    heartbeat_timeout: "90s"
    udp_packet_size: 1500
  
  # Authentication configuration
  auth:
    method: "token"       # "token" or "oidc"
    token: ""             # Will be obtained from token_endpoint
    token_endpoint: "https://api.pipeops.io/auth/frp-token"
    refresh_token: ""
    oidc:
      issuer: ""
      audience: ""
      scope: "openid"
      client_id: ""
      client_secret: ""
  
  # Tunnel configurations
  tunnels:
    - name: "k8s-proxy"
      type: "http"
      local_ip: "127.0.0.1"
      local_port: 8080
      subdomain: ""       # Will be assigned by server
      enabled: true
    - name: "admin-api"
      type: "http"
      local_ip: "127.0.0.1"
      local_port: 8081
      subdomain: ""       # Will be assigned by server
      enabled: false

# Kubernetes configuration
kubernetes:
  # Path to kubeconfig file (leave empty for in-cluster config)
  kubeconfig: ""
  
  # Whether to use in-cluster configuration
  in_cluster: true
  
  # Default namespace for agent operations
  namespace: "pipeops-system"

# Logging configuration
logging:
  # Log level (debug, info, warn, error)
  level: "info"
  
  # Log format (json, text)
  format: "json"
  
  # Log output (stdout, stderr, file path)
  output: "stdout"
